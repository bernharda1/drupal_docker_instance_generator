# STAGING (public + auth middleware)
# Projektpfad: /srv/stag/<project>
COMPOSER_PROJECT_NAME=infrasightsolutions/drupal
PROJECT_BASE_PATH=/srv/stag
COMPOSE_PROFILES=web-nginx,reverse-proxy,db-mysql,cache-redis,tools

STACK_ENV=stag
EDGE_NETWORK_NAME=stag_net
TRAEFIK_DOCKER_NETWORK=proxy

# Beliebige öffentliche STAG-Domain setzen (DNS muss auf Traefik zeigen)
PUBLIC_DOMAIN=change-me-stag.example.com
TRAEFIK_ENABLE=true
TRAEFIK_ENTRYPOINT_WEB=web
TRAEFIK_ENTRYPOINT_WEBSECURE=websecure
TRAEFIK_CERTRESOLVER=le-dns
TRAEFIK_TLS_OPTIONS=default
TRAEFIK_SECURITY_MIDDLEWARES=staging-auth@file

# Static IPv6 optional: use docker-compose.ipv6.yml or docker-compose.ipv6.reverse-proxy.yml
# WEB_IPV6_ADDRESS=2a0a:4cc0:0:2d05:1300::10
# WEB_BACKEND_IPV6_ADDRESS=2a0a:4cc0:0:2d05:1300::11
PUBLIC_BIND_ADDRESS=[::]
PUBLIC_BIND_ADDRESS_V4=127.0.0.1

UPSTREAM_HOST=web-nginx
UPSTREAM_PORT=8080
REVERSE_PROXY_HOST_PORT=8088
VARNISH_HOST_PORT=6081

DRUPAL_DB_DRIVER=mysql
DRUPAL_DB_HOST=db-mysql
DRUPAL_DB_PORT=3306
DRUPAL_DB_NAME=drupal
DRUPAL_DB_USER=drupal
DRUPAL_DB_PASSWORD=drupal
DRUPAL_REDIS_HOST=redis

MYSQL_ROOT_PASSWORD=change-me-stag
MYSQL_DATABASE=drupal
MYSQL_USER=drupal
MYSQL_PASSWORD=change-me-stag

PHPMYADMIN_HOST_PORT=8081
PHPMYADMIN_DOMAIN=phpmyadmin.change-me-stag.example.com

MAILPIT_SMTP_HOST_PORT=1025
MAILPIT_UI_HOST_PORT=8025
MAILPIT_DOMAIN=mailpit.change-me-stag.example.com

# Optional überschreiben, falls mehrere Domains benötigt werden:
# DRUPAL_TRUSTED_HOST_PATTERNS=^localhost$,^127\\.0\\.0\\.1$,^change-me-stag\.example\.com$

FPM_MEM_LIMIT=1024m
FPM_CPUS=1.00
WEB_NGINX_MEM_LIMIT=512m
WEB_NGINX_CPUS=0.75
REVERSE_PROXY_MEM_LIMIT=256m
REVERSE_PROXY_CPUS=0.30
MYSQL_MEM_LIMIT=1024m
MYSQL_CPUS=1.00
REDIS_MEM_LIMIT=256m
REDIS_CPUS=0.30
COMPOSER_MEM_LIMIT=768m
COMPOSER_CPUS=0.80
DRUSH_MEM_LIMIT=512m
DRUSH_CPUS=0.50
NODE_MEM_LIMIT=768m
NODE_CPUS=0.80
