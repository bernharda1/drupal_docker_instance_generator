# Image naming
DRUPAL_IMAGE_NAME=infrasight/drupal11-fpm
DRUPAL_IMAGE_TAG=local
DRUPAL_BASE_IMAGE=php:8.4.18-fpm-bookworm
COMPOSER_PROJECT_NAME=infrasightsolutions/drupal
PROJECT_BASE_PATH=/home/dev/projects
CONTAINER_PREFIX=drupal_dev
TRAEFIK_PREFIX=drupal-dev

# --- Service-Auswahl ---
# Wähle hier die zu startenden Profile (Comma-separated):
# Webserver: web-nginx | web-apache | web-ols
# Datenbank: db-mysql | db-mariadb | db-postgres
# Cache: cache-redis | cache-varnish
# Optional: reverse-proxy, phpmyadmin, mailpit, tools
COMPOSE_PROFILES=web-nginx,fpm,reverse-proxy,db-mysql,cache-redis,phpmyadmin,mailpit,tools

# Dokumentation/Orientierung für Team (informativ): nginx | apache | openlitespeed
WEB_SERVER=nginx
# Reverse-Proxy aktiv, wenn Profil `reverse-proxy` gesetzt ist
ENABLE_REVERSE_PROXY=true
# Datenbankauswahl (informativ): mysql | mariadb | postgres
DB_SERVER=mysql
# Cacheauswahl (informativ): redis | varnish | none
CACHE_SERVER=redis

# Runtime defaults
TZ=Europe/Vienna
UID=1000
GID=1000

# Hostnames / Domain
PUBLIC_DOMAIN=infrasight.projects.infrasight-solutions.com
FPM_HOSTNAME=drupal-fpm
WEB_HOSTNAME=web-nginx
REVERSE_PROXY_HOSTNAME=reverse-proxy
MYSQL_HOSTNAME=db-mysql
MARIADB_HOSTNAME=db-mariadb
POSTGRES_HOSTNAME=db-postgres
REDIS_HOSTNAME=redis
VARNISH_HOSTNAME=varnish
PHPMYADMIN_HOSTNAME=phpmyadmin
MAILPIT_HOSTNAME=mailpit
COMPOSER_HOSTNAME=composer
DRUSH_HOSTNAME=drush
NODE_HOSTNAME=node

# --- Netzwerk/Umgebung ---
# Bestehende externe Netze: dev_net | stag_net | prod_net
STACK_ENV=dev
EDGE_NETWORK_NAME=dev_net

# Optional: statische Container-IPv6 nur bei Bedarf aktivieren
# Aktivierung über:
#   docker compose -f docker-compose.yml -f docker-compose.ipv6.yml up -d --build
# Für STAG/PROD je Umgebung passend setzen (muss im Subnetz von EDGE_NETWORK_NAME liegen)
# WEB_IPV6_ADDRESS=2a0a:4cc0:0:2d05:1300::10
WEB_IPV6_ADDRESS=

# Wenn `reverse-proxy` aktiv ist und die primäre öffentliche IPv6 tragen soll:
#   docker compose -f docker-compose.yml -f docker-compose.ipv6.reverse-proxy.yml up -d --build
# Dann gilt:
# - WEB_IPV6_ADDRESS = primäre öffentliche IPv6 auf reverse-proxy
# - WEB_BACKEND_IPV6_ADDRESS = eigene IPv6 für den Web-Container im edge_net
WEB_BACKEND_IPV6_ADDRESS=

# Optional für phpMyAdmin (nur wirksam wenn Profil `phpmyadmin` aktiv ist)
PHPMYADMIN_IPV6_ADDRESS=

# Externe Bind-Adresse für öffentlich erreichbare Ports (IPv6 only empfohlen)
# Beispiele: [::] | [2a0a:4cc0:0:2d05::100]
PUBLIC_BIND_ADDRESS=[::]
# Optional zusätzlicher IPv4 Bind (z. B. für localhost-Tests)
PUBLIC_BIND_ADDRESS_V4=127.0.0.1

# Traefik Integration
TRAEFIK_ENABLE=true
TRAEFIK_DOCKER_NETWORK=proxy
TRAEFIK_ENTRYPOINT_WEB=web
TRAEFIK_ENTRYPOINT_WEBSECURE=websecure
# Für Subdomains unter projects.infrasight-solutions.com ist DNS-01 (`le-dns`) empfohlen
TRAEFIK_CERTRESOLVER=le-dns
TRAEFIK_TLS_OPTIONS=default
# Beispiel: dev-vpn-only@file,staging-auth@file
TRAEFIK_SECURITY_MIDDLEWARES=dev-vpn-only@file
# Optional nur für phpMyAdmin/Mailpit-UI überschreiben (sonst wie TRAEFIK_SECURITY_MIDDLEWARES)
TRAEFIK_UI_SECURITY_MIDDLEWARES=

# Reverse proxy target and host port (nur relevant mit COMPOSE_PROFILES inkl. reverse-proxy)
UPSTREAM_HOST=web-nginx
UPSTREAM_PORT=8080
REVERSE_PROXY_HOST_PORT=8088

# Drupal DB defaults (werden in drupal-fpm als ENV bereitgestellt)
DB_DRIVER=mysql
DB_HOST=db-mysql
DB_PORT=3306
DB_NAME=drupal
DB_USER=drupal
DB_PASS=drupal
DRUPAL_HASH_SALT=local-change-me
CONFIG_SYNC_DIRECTORY=sites/default/files/config_sync/sync
DRUPAL_TRUSTED_HOST_PATTERNS=^localhost$,^127\\.0\\.0\\.1$,^infrasight\.projects\.infrasight-solutions\.com$
DRUPAL_ENV_SERVICES_FILE=sites/development.services.yml
DRUPAL_WEB_SERVER=nginx
DRUPAL_CACHE_BACKEND=database
DRUPAL_REDIS_ENABLED=0
DRUPAL_REDIS_PORT=6379
DRUPAL_REDIS_PASSWORD=
DRUPAL_REDIS_PREFIX=drupal
DRUPAL_VARNISH_ENABLED=0
DRUPAL_REVERSE_PROXY_ENABLED=0
DRUPAL_REVERSE_PROXY_ADDRESSES=127.0.0.1

# Drupal writable directories (safety-first)
DRUPAL_WRITABLE_UID=33
DRUPAL_WRITABLE_GID=33
DRUPAL_WRITABLE_DIR_MODE=2775
DRUPAL_WRITABLE_FILE_MODE=0664
DRUPAL_SITES_RECURSIVE_CHOWN=0

# Drupal Redis/Mail defaults
DRUPAL_REDIS_HOST=redis
DRUPAL_MAIL_HOST=mailpit
DRUPAL_MAIL_PORT=1025

# MySQL
MYSQL_ROOT_PASSWORD=root
MYSQL_DATABASE=drupal
MYSQL_USER=drupal
MYSQL_PASSWORD=drupal

# MariaDB
MARIADB_ROOT_PASSWORD=root
MARIADB_DATABASE=drupal
MARIADB_USER=drupal
MARIADB_PASSWORD=drupal

# PostgreSQL
POSTGRES_DB=drupal
POSTGRES_USER=drupal
POSTGRES_PASSWORD=drupal

# Redis (keine Pflicht-ENV)

# Varnish
VARNISH_BACKEND_HOST=web-nginx
VARNISH_BACKEND_PORT=8080
VARNISH_HOST_PORT=6081

# phpMyAdmin
PMA_HOST=db-mysql
PMA_PORT=3306
PMA_USER=root
PMA_PASSWORD=root
PMA_UPLOAD_LIMIT=256M
PHPMYADMIN_DOMAIN=phpmyadmin.infrasight.projects.infrasight-solutions.com

# Mailpit
MAILPIT_SMTP_HOST_PORT=1025
MAILPIT_MAX_MESSAGES=5000
MAILPIT_DOMAIN=mailpit.infrasight.projects.infrasight-solutions.com

# Service startup update policy: off | check | upgrade
FPM_UPDATE_POLICY=check
FPM_UPDATE_TARGET=system

RP_UPDATE_POLICY=off
RP_UPDATE_TARGET=system

COMPOSER_UPDATE_POLICY=off
COMPOSER_UPDATE_TARGET=system

DRUSH_UPDATE_POLICY=off
DRUSH_UPDATE_TARGET=system

NODE_UPDATE_POLICY=off
NODE_UPDATE_TARGET=system

# Resource Limits
FPM_MEM_LIMIT=1024m
FPM_CPUS=1.00

WEB_NGINX_MEM_LIMIT=384m
WEB_NGINX_CPUS=0.50
WEB_APACHE_MEM_LIMIT=384m
WEB_APACHE_CPUS=0.50
WEB_OLS_MEM_LIMIT=512m
WEB_OLS_CPUS=0.75

REVERSE_PROXY_MEM_LIMIT=256m
REVERSE_PROXY_CPUS=0.30

MYSQL_MEM_LIMIT=1024m
MYSQL_CPUS=1.00
MARIADB_MEM_LIMIT=1024m
MARIADB_CPUS=1.00
POSTGRES_MEM_LIMIT=1024m
POSTGRES_CPUS=1.00

REDIS_MEM_LIMIT=256m
REDIS_CPUS=0.30
VARNISH_MEM_LIMIT=384m
VARNISH_CPUS=0.40

PHPMYADMIN_MEM_LIMIT=256m
PHPMYADMIN_CPUS=0.30
MAILPIT_MEM_LIMIT=256m
MAILPIT_CPUS=0.30

COMPOSER_MEM_LIMIT=768m
COMPOSER_CPUS=0.80
DRUSH_MEM_LIMIT=512m
DRUSH_CPUS=0.50
NODE_MEM_LIMIT=768m
NODE_CPUS=0.80
